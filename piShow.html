
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>pi Show</title>

  <link rel="stylesheet" type="text/css" href="css/piBooth.css">
</head>

<body>
  <div id="img-container">
  </div>

  <script language="javascript">
    var container = document.getElementById('img-container');

    // insert a new picture
    var showPicture = function(url) {
      if(url === null || typeof url === 'undefined') {
        return;
      }

      container.removeChild(container.childNodes[0]);

      var img = document.createElement("img");
      img.src = url;
      container.appendChild(img);
    };

    var getNextPictureUrl = function() {
      return new Promise((resolve, reject) => {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'http://localhost:8443/nextPicture');
        xhr.onreadystatechange = function() {
          if (xhr.readyState>3 && xhr.status==200) {
            resolve(xhr.responseText);
          } else if (xhr.status==404) {
            reject(xhr.responseText);
          }
        };
        xhr.send();
      });
    };

    var loopPictures = function() {
      setTimeout(() => {
        getNextPictureUrl().then(showPicture);
        loopPictures();
      }, 10000);
    };

    getNextPictureUrl().then(showPicture);
    loopPictures();
  </script>
</body>
</html>
